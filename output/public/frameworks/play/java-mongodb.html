<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/play/java-mongodb.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Play Java MongoDB App on Cloud Foundry' property='og:title'>
<meta content='Play Java Application with MongoDB Backend Deployed on Cloud Foundry' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Play Java MongoDB App on Cloud Foundry</title>
<link href='/docs/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/docs/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/docs/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/docs/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/docs/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/docs/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/docs/js/documentation.js' type='text/javascript'></script>
<script src='/docs/js/jquery.easing.js' type='text/javascript'></script>
<script src='/docs/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/docs/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/docs/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/docs/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Play Java MongoDB App on Cloud Foundry</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/docs/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/docs/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/docs/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/docs/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/docs/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/docs/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/docs/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/docs/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/docs/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/docs/frameworks/ruby/rails-3-1-and-3-2.html'>Rails 3.1 and 3.2</a>
</li>
<li>
<a href='/docs/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/docs/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/docs/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/docs/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/docs/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/docs/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/docs/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/docs/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/docs/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/docs/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/docs/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/docs/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/docs/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/docs/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/docs/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/docs/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/docs/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/docs/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/docs/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/docs/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/docs/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/docs/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/docs/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/samples/samples.html'>Sample Apps</a>
</li>
<li class='js-subtopic'>
<a href='/docs/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/docs/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
<p class='forgot_pass'>
<a href='http://my.cloudfoundry.com/passwd'>Forgot password?</a>
</p>
</div>
<div class='span-11 last'>
<h2>Play Java Application with MongoDB Backend Deployed on Cloud Foundry</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/tags/play" rel="tag">play</a><a href="/tags/java" rel="tag">java</a><a href="/tags/mongodb" rel="tag">mongodb</a><a href="/tags/tutorial" rel="tag">tutorial</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-10-08
</span>
</p>
<div id='social-share'></div>
<p>This is a guide for Java developers using the Play framework and MongoDB NoSQL database to
build and deploy their apps on Cloud Foundry. It shows you how to set up and access MongoDB using
a native Java driver. The app uses a local instance of MongoDB for development and an
existing MongoDB service running on Cloud Foundry for deployment.</p>

<p>Before you get started, you’ll need the following:</p>

<ul>
<li>
    <p>A <a href="http://cloudfoundry.com/signup">Cloud Foundry account</a></p>
  </li>
  <li>
    <p>The <a href="/tools/vmc/installing-vmc.html">vmc</a> Cloud Foundry command line tool</p>
  </li>
  <li>
    <p>A <a href="http://www.playframework.org/documentation/2.0.2/Home">Play 2.0 </a> installation</p>
  </li>
  <li>
    <p>A Local <a href="http://www.mongodb.org/downloads">MongoDB</a>  Server and Client setup</p>
  </li>
</ul><h2 id="introduction">Introduction</h2>

<p>In this tutorial, we take a simple use case:</p>

<p>Modifying and Deploying the <a href="http://www.playframework.org/documentation/2.0.2/JavaTodoList">TodoList</a>
app to Cloud Foundry with the persistent layer wired to a MongoDB NoSQL database. Since the original
app was written for a SQL datastore using Ebeans, we will rewrite the controller and the model
of this app to work with the MongoDB back end.</p>

<h2 id="todolist-play-app">TodoList Play App</h2>

<p>TodoList is used to create and manage tasks.</p>

<p><img src="/images/play/todolist-usecase.png" alt="todolist-usecase.png"></p>

<p>These tasks are created by the users and the data
is stored in underlying relational store.</p>

<p>A high-level interaction diagram of the application using Play runtime and MongoDB can be
found below:</p>

<p><img src="/images/play/play-mongodb.png" alt="play-mongodb.png"></p>

<h3 id="steps-to-create-the-app">Steps to Create the App</h3>
<p>In this section, we outline the steps to create the app from the default Play app template.</p>

<h4 id="create-a-new-play-app">Create a New Play App</h4>

<p>Type the command <code>play new todolist-java-mongodb</code> on the command line. Choose Option 2 to create
a simple Java application.</p>

<pre class="terminal">
$ play new todolist-java-mongodb
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

The new application will be created in /Users/rajdeepd/vmware/play/mysamples/todolist-java-mongodb

What is the application name?
&gt; todolist-java-mongodb

Which template do you want to use for this new application?

  1 - Create a simple Scala application
  2 - Create a simple Java application
  3 - Create an empty project

&gt; 2

OK, application todolist-java-mongodb is created.

Have fun!
</pre>

<h4 id="create-an-eclipse-project">Create an Eclipse Project</h4>

<p>Use Play’s ‘eclipsify’ command to create an Eclipse project.</p>

<pre class="terminal">
$ cd todolist-java-mongodb
$ play
[info] Loading project definition from /Users/&lt;username&gt;/play/mysamples/
todolist-java-mongodb/project
[info] Set current project to todolist-java-mongodb (in build file:/Users/&lt;username&gt;/play/mysamples/todolist-java-mongodb/)
       _            _
 _ __ | | __ _ _  _| |
| '_ \| |/ _' | || |_|
|  __/|_|\____|\__ (_)
|_|            |__/

play! 2.0.2, http://www.playframework.org

&gt; Type "help play" or "license" for more information.
&gt; Type "exit" or use Ctrl+D to leave this console.

[todolist-java-mongodb] $ eclipsify
[info] About to create Eclipse project files for your project(s).
[info] Updating {file:/Users/&lt;username&gt;/play/mysamples/todolist-java-mongodb/}todolist-java-mongodb...
[info] Done updating.
[info] Compiling 4 Scala sources and 2 Java sources to /Users/&lt;username&gt;/play/mysamples/
todolist-java-mongodb/target/scala-2.9.1/classes...
[info] Successfully created Eclipse project files for project(s):
[info] todolist-java-mongodb
[todolist-java-mongodb] $
</pre>

<p>Import the created project into Eclipse via File -&gt; Import and point to the root folder of
the project <code>todolist-java-mongodb</code>.</p>

<p><img src="/images/screenshots/play/eclipse-import-mongoproject-1.png" alt="eclipse-import-mongoproject-1.png"></p>

<p><img src="/images/screenshots/play/eclipse-import-mongoproject-2.png" alt="eclipse-import-mongoproject-2.png"></p>

<h4 id="add-the-mongodb-driver-and-gson-jar-to-the-project">Add the MongoDB Driver and Gson Jar to the Project</h4>

<p>Download and add the MongoDB driver file and Gson Jar to the lib folder of the project.</p>

<ul>
<li><a href="http://www.mongodb.org/downloads">mongo-0.2.8.jar</a></li>
  <li><a href="http://code.google.com/p/google-gson/downloads/list">gson-2.2.2.jar</a></li>
</ul><h4 id="modify-the-router">Modify the Router</h4>
<p>Define the following routes in the <code>routes</code> configuration file. It maps the relative URLs
 to the appropriate actions in <code>controllers.Application.java</code></p>

<h5 id="index-page">Index Page</h5>
<p>The mapping below maps the <code>HTTP GET</code> call to the <code>/</code> URL, which in turn maps to the index.html page.</p>

<pre><code class="language-javascript"><span class="nx">GET</span>     <span class="o">/</span>                           <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span></code></pre>

<h5 id="get-all-tasks">Get All Tasks</h5>
<p>The mapping below lists all of the tasks at the URL <code>/tasks</code> using the <code>HTTP GET</code> call.</p>

<pre><code class="language-javascript"><span class="nx">GET</span>     <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">tasks</span><span class="p">()</span></code></pre>

<h5 id="create-a-task">Create a Task</h5>
<p>The mapping below maps the <code>controllers.Application.newTask()</code> controller action to the <code>HTTP POST</code> call, which in turn maps to the URL <code>/tasks</code>.</p>

<pre><code class="language-javascript"><span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">newTask</span><span class="p">()</span></code></pre>

<h5 id="delete-a-task">Delete a Task</h5>
<p>The mapping below maps the <code>controllers.Application.deleteTask(:id Long)</code> controller action to
the <code>HTTP POST</code> call, which in turn maps to the URL <code>/tasks/:id/delete</code> where id is the unique id for the task.</p>

<pre><code class="language-javascript"><span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span><span class="o">/:</span><span class="nx">id</span><span class="o">/</span><span class="k">delete</span>        <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">deleteTask</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">Long</span><span class="p">)</span></code></pre>

<h5 id="complete-listing">Complete Listing</h5>

<pre><code class="language-javascript"><span class="err">#</span> <span class="nx">Home</span> <span class="nx">page</span>
<span class="nx">GET</span>     <span class="o">/</span>                       <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">index</span><span class="p">()</span>

<span class="err">#</span> <span class="nx">Map</span> <span class="kr">static</span> <span class="nx">resources</span> <span class="nx">from</span> <span class="nx">the</span> <span class="o">/</span><span class="kr">public</span> <span class="nx">folder</span> <span class="nx">to</span> <span class="nx">the</span> <span class="o">/</span><span class="nx">assets</span> <span class="nx">URL</span> <span class="nx">path</span>
<span class="nx">GET</span>     <span class="o">/</span><span class="nx">assets</span><span class="o">/*</span><span class="nx">file</span>           <span class="nx">controllers</span><span class="p">.</span><span class="nx">Assets</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="nx">path</span><span class="o">=</span><span class="s2">"/public"</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">Tasks</span>
<span class="nx">GET</span>     <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">tasks</span><span class="p">()</span>
<span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span>                  <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">newTask</span><span class="p">()</span>
<span class="nx">POST</span>    <span class="o">/</span><span class="nx">tasks</span><span class="o">/:</span><span class="nx">id</span><span class="o">/</span><span class="k">delete</span>       <span class="nx">controllers</span><span class="p">.</span><span class="nx">Application</span><span class="p">.</span><span class="nx">deleteTask</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">Long</span><span class="p">)</span></code></pre>

<h4 id="modify-the-model">Modify the Model</h4>
<p>Create a class Task in the models package which will interface with the underlying MongoDB driver.
Task has two public fields <code>id</code> and ‘label`.</p>
<pre><code class="language-java"><span class="kn">package</span> <span class="n">models</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Task</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">label</span><span class="o">;</span>

<span class="o">}</span></code></pre>

<h4 id="modify-the-controller">Modify the Controller</h4>
<p>In this section, you will execute the following tasks to implement the Controller functionality:</p>

<h5 id="create-action-methods">Create Action Methods</h5>
<p>Open the controller file and add the following actions.</p>

<pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">Controller</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nf">tasks</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">tasks</span><span class="o">()</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">getTaskList</span><span class="o">()</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Result</span> <span class="nf">newTask</span><span class="o">()</span> <span class="o">{</span>
     
  <span class="o">}</span>
<span class="o">}</span></code></pre>

<h5 id="add-utility-method-to-access-mongodb">Add Utility Method to Access MongoDB</h5>
<p>This method returns the local or remote instance of MongoDB depending on the boolean
parameter <code>local</code>.</p>

<p>For a local instance, set <code>local=true</code>. Set <code>local=false</code> when we deploy it to cloudfoundry.com.</p>

<pre><code class="language-java"><span class="kd">private</span> <span class="kd">static</span> <span class="n">DB</span> <span class="nf">getDb</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="na">Configuration</span><span class="o">.</span><span class="na">root</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"mongo.remote.username"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="na">Configuration</span><span class="o">.</span><span class="na">root</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"mongo.remote.password"</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">langs</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="na">Configuration</span><span class="o">.</span><span class="na">root</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"application.langs"</span><span class="o">);</span>
    <span class="kt">boolean</span> <span class="n">local</span>  <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

    <span class="n">String</span> <span class="n">localHostName</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="na">Configuration</span><span class="o">.</span><span class="na">root</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"mongo.local.hostname"</span><span class="o">);</span>
    <span class="n">Integer</span>  <span class="n">localPort</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="na">Configuration</span><span class="o">.</span><span class="na">root</span><span class="o">().</span><span class="na">getInt</span><span class="o">(</span><span class="s">"mongo.local.port"</span><span class="o">);</span>

    <span class="n">String</span> <span class="n">remoteHostName</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="na">Configuration</span><span class="o">.</span><span class="na">root</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="s">"mongo.remote.hostname"</span><span class="o">);</span>
    <span class="n">Integer</span> <span class="n">remotePort</span> <span class="o">=</span> <span class="n">play</span><span class="o">.</span><span class="na">Configuration</span><span class="o">.</span><span class="na">root</span><span class="o">().</span><span class="na">getInt</span><span class="o">(</span><span class="s">"mongo.remote.port"</span><span class="o">);</span>

    <span class="n">Mongo</span> <span class="n">m</span><span class="o">;</span>
    <span class="n">DB</span> <span class="n">db</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span><span class="o">(</span><span class="n">local</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">hostname</span> <span class="o">=</span> <span class="n">localHostName</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">localPort</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mongo</span><span class="o">(</span> <span class="n">hostname</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">getDB</span><span class="o">(</span> <span class="s">"db"</span> <span class="o">);</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Exception while intiating Local MongoDB"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">hostname</span> <span class="o">=</span> <span class="n">remoteHostName</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">remotePort</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mongo</span><span class="o">(</span> <span class="n">hostname</span> <span class="o">,</span> <span class="n">port</span><span class="o">);</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">getDB</span><span class="o">(</span> <span class="s">"db"</span> <span class="o">);</span>
            <span class="kt">boolean</span> <span class="n">auth</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">authenticate</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">password</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">());</span>
        <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Exception while intiating Local MongoDB"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">db</span><span class="o">;</span>
<span class="o">}</span></code></pre>

<h4 id="add-parameters-to-applicationconfig">Add Parameters to application.config</h4>
<p>The following parameters are used by the MongoDB driver to connect to a MongDB server either
on a local machine or inside cloudfoundry.com.</p>

<pre><code class="language-javascript"><span class="nx">mongo</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="nx">hostname</span><span class="o">=</span><span class="nx">localhost</span>
<span class="nx">mongo</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="nx">port</span><span class="o">=</span><span class="mi">27017</span>

<span class="nx">mongo</span><span class="p">.</span><span class="nx">remote</span><span class="p">.</span><span class="nx">hostname</span><span class="o">=</span><span class="s2">"172.30.XX.XX"</span>
<span class="nx">mongo</span><span class="p">.</span><span class="nx">remote</span><span class="p">.</span><span class="nx">port</span><span class="o">=</span><span class="mi">25189</span>
<span class="nx">mongo</span><span class="p">.</span><span class="nx">remote</span><span class="p">.</span><span class="nx">username</span><span class="o">=&lt;</span><span class="nx">username</span> <span class="nx">obtained</span> <span class="nx">from</span> <span class="nx">caldecott</span><span class="o">&gt;</span>
<span class="nx">mongo</span><span class="p">.</span><span class="nx">remote</span><span class="p">.</span><span class="nx">password</span><span class="o">=&lt;</span><span class="nx">password</span> <span class="nx">obtained</span> <span class="nx">from</span> <span class="nx">caldecott</span><span class="o">&gt;</span></code></pre>

<h2 id="build-and-run-the-app-locally">Build and Run the App Locally</h2>
<p>Before you run the client locally make sure MongoDB is running locally.</p>

<pre class="terminal">
$ ./mongod --dbpath=../../mongo/db/
Thu Aug 30 18:24:09 [initandlisten] MongoDB starting : pid=45601 port=27017 dbpath=
../../mongo/db/ 64-bit host=username.local
Thu Aug 30 18:24:09 [initandlisten] db version v2.0.6, pdfile version 4.5
Thu Aug 30 18:24:09 [initandlisten] git version: e1c0cbc25863f6356aa4e31375add7bb49fb05bc
Thu Aug 30 18:24:09 [initandlisten] build info: Darwin erh2.10gen.cc 9.8.0 Darwin Kernel s
Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/
RELEASE_I386 i386 BOOST_LIB_VERSION=1_40
Thu Aug 30 18:24:09 [initandlisten] options: { dbpath: "../../mongo/db/" }
Thu Aug 30 18:24:09 [initandlisten] journal dir=../../mongo/db/journal
Thu Aug 30 18:24:09 [initandlisten] recover : no journal files present, no recovery needed
Thu Aug 30 18:24:09 [websvr] admin web console waiting for connections on port 28017
Thu Aug 30 18:24:09 [initandlisten] waiting for connections on port 27017

</pre>

<p>You can run the app locally using the standard command from within the app folder.</p>

<pre class="terminal">
$play run
</pre>

<p>You should see the following screen when your browser is pointed to <code>http://localhost:9000</code>.</p>

<p><img src="/images/screenshots/play/play-todolist-java-mongodb-local.png" alt="play-todolist-java-mongodb-local.png"></p>

<p>You can connect to the local MongoDB instance using the <code>mongo</code> command line shell and then query the collection.
<code>mongo</code> is shell binary. The exact location might vary depending on the installation method and platform.</p>

<pre class="terminal">
$ ./mongo
MongoDB shell version: 2.0.6
connecting to: test
&gt; use db;
switched to db db
&gt; db.tasklist.find();
{ "_id" : ObjectId("50403ee86970ef63a14dea87"), "id" : NumberLong(0), "label" : "Drink Coffee" }
{ "_id" : ObjectId("50403efc6970ef63a14dea88"), "id" : NumberLong(1), "label" : "Write Play tutorial" }
{ "_id" : ObjectId("504044386970ef63a14dea89"), "id" : NumberLong(2), "label" : "" }
&gt;
</pre>

<h2 id="deploy-the-app-on-cloud-foundry">Deploy the App on Cloud Foundry</h2>
<p>Deployment to Cloud Foundry can be done in two simple steps:</p>

<ul>
<li>Create a distribution</li>
  <li>Push the distribution using <code>vmc push</code>
</li>
</ul><p>Commands below show the exact commands and output when the app is deployed.</p>

<pre class="terminal">
$ play dist
[info] Loading project definition from /Users/&lt;username&gt;/vmware/play/mysamples/
todolist-java-mongodb/project
[info] Set current project to todolist-java-mongodb (in build file:/Users/&lt;username&gt;/
vmware/play/mysamples/todolist-java-mongodb/)
[info] Compiling 1 Java source to /Users/&lt;username&gt;/vmware/play/mysamples/
todolist-java-mongodb/target/scala-2.9.1/classes...
[info] Packaging /Users/&lt;username&gt;/vmware/play/mysamples/todolist-java-mongodb/target/
scala-2.9.1/todolist-java-mongodb_2.9.1-1.0-SNAPSHOT.jar ...
[info] Done packaging.

Your application is now ready in /Users/&lt;username&gt;/vmware/play/mysamples/todolist-java-mongodb/dist/
todolist-java-mongodb-1.0-SNAPSHOT.zip

[success] Total time: 8 s, completed Aug 31, 2012 12:06:54 AM

$ cd dist

$ vmc push
Would you like to deploy from the current directory? [Yn]: Y
Application Name: todolist-java-mongodb
Detected a Play Framework Application, is this correct? [Yn]: Y
Application Deployed URL [todolist-java-mongodb.cloudfoundry.com]:
Memory reservation (128M, 256M, 512M, 1G, 2G) [256M]:
How many instances? [1]: 1
Bind existing services to 'todolist-java-mongodb'? [yN]: y
1: mongodb-a1c55
2: mysql-2c653
3: mysql-2ea2b
4: mysql-c92b7
5: mysql-eeb13
6: mysql-first_app_ruby
7: postgresql-9a20a
8: rabbitmq-b25e8
Which one?: 1
Bind another? [yN]: N
Create services to bind to 'todolist-java-mongodb'? [yN]: N
Would you like to save this configuration? [yN]: y
Manifest written to manifest.yml.
Creating Application: OK
Binding Service [mongodb-a1c55]: OK
Uploading Application:
  Checking for available resources: OK
  Processing resources: OK
  Packing application: OK
  Uploading (84K): OK
Push Status: OK
Staging Application 'todolist-java-mongodb': OK
Starting Application 'todolist-java-mongodb': OK


</pre>

<p>Upon completion of deployment, we can go and visit the actual app at the URL <code>[app-name].cloudfoundry.com]</code></p>

<p><img src="/images/screenshots/play/play-todolist-java-mongodb.png" alt="play-todolist-java-mongodb.png"></p>

<h2 id="summary">Summary</h2>
<p>In this tutorial, we learned how to build and deploy a basic Play Java app with MongoDB as the backend
using a native MongoDB driver.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
